

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>utool.util_path &mdash; utool 1.0.0.dev1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="utool 1.0.0.dev1 documentation" href="../../index.html"/>
        <link rel="up" title="utool" href="../utool.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> utool</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../utool.html">utool package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.DynamicStruct">utool.DynamicStruct module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.Preferences">utool.Preferences module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.Printable">utool.Printable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_alg">utool.util_alg module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_aliases">utool.util_aliases module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_arg">utool.util_arg module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_assert">utool.util_assert module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_autogen">utool.util_autogen module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_cache">utool.util_cache module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_class">utool.util_class module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_config">utool.util_config module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_cplat">utool.util_cplat module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_csv">utool.util_csv module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_dbg">utool.util_dbg module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_decor">utool.util_decor module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_dev">utool.util_dev module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_dict">utool.util_dict module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_distances">utool.util_distances module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_func">utool.util_func module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_git">utool.util_git module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_grabdata">utool.util_grabdata module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_gridsearch">utool.util_gridsearch module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_hash">utool.util_hash module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_inject">utool.util_inject module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_inspect">utool.util_inspect module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_io">utool.util_io module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_iter">utool.util_iter module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_latex">utool.util_latex module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_list">utool.util_list module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_logging">utool.util_logging module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_num">utool.util_num module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_numpy">utool.util_numpy module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_parallel">utool.util_parallel module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_path">utool.util_path module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_print">utool.util_print module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_progress">utool.util_progress module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_regex">utool.util_regex module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_resources">utool.util_resources module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_set">utool.util_set module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_setup">utool.util_setup module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_six">utool.util_six module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_str">utool.util_str module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_sysreq">utool.util_sysreq module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_tests">utool.util_tests module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_time">utool.util_time module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool.util_type">utool.util_type module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utool.html#module-utool">Module contents</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">utool</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../utool.html">utool</a> &raquo;</li>
      
    <li>utool.util_path</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <h1>Source code for utool.util_path</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">python -c &quot;import utool, doctest; print(doctest.testmod(utool.util_path))&quot;</span>

<span class="sd">This module becomes nav</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">zip</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">filterfalse</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">range</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">normpath</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">isdir</span><span class="p">,</span> <span class="n">isfile</span><span class="p">,</span>
                     <span class="n">exists</span><span class="p">,</span> <span class="n">islink</span><span class="p">,</span> <span class="n">ismount</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">realpath</span><span class="p">,</span>
                     <span class="n">splitdrive</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">utool.util_regex</span> <span class="kn">import</span> <span class="n">extend_regex</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_dbg</span>
<span class="kn">from</span> <span class="nn">utool.util_progress</span> <span class="kn">import</span> <span class="n">progress_func</span>
<span class="kn">from</span> <span class="nn">utool._internal</span> <span class="kn">import</span> <span class="n">meta_util_path</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_inject</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_arg</span>
<span class="kn">from</span> <span class="nn">utool._internal.meta_util_arg</span> <span class="kn">import</span> <span class="n">NO_ASSERTS</span><span class="p">,</span> <span class="n">VERBOSE</span><span class="p">,</span> <span class="n">VERYVERBOSE</span><span class="p">,</span> <span class="n">QUIET</span>
<span class="k">print</span><span class="p">,</span> <span class="n">print_</span><span class="p">,</span> <span class="n">printDBG</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">util_inject</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;[util_path]&#39;</span><span class="p">)</span>


<span class="n">PRINT_CALLER</span> <span class="o">=</span> <span class="n">util_arg</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--print-caller&#39;</span><span class="p">)</span>  <span class="c"># FIXME: name</span>

<span class="n">__IMG_EXTS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s">&#39;.png&#39;</span><span class="p">,</span> <span class="s">&#39;.tif&#39;</span><span class="p">,</span> <span class="s">&#39;.tiff&#39;</span><span class="p">,</span> <span class="s">&#39;.ppm&#39;</span><span class="p">]</span>
<span class="n">__LOWER_EXTS</span> <span class="o">=</span> <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">__IMG_EXTS</span><span class="p">]</span>
<span class="n">__UPPER_EXTS</span> <span class="o">=</span> <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">__IMG_EXTS</span><span class="p">]</span>
<span class="n">IMG_EXTENSIONS</span> <span class="o">=</span>  <span class="nb">set</span><span class="p">(</span><span class="n">__LOWER_EXTS</span> <span class="o">+</span> <span class="n">__UPPER_EXTS</span><span class="p">)</span>


<div class="viewcode-block" id="newcd"><a class="viewcode-back" href="../../utool.html#utool.util_path.newcd">[docs]</a><span class="k">def</span> <span class="nf">newcd</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; DEPRICATE &quot;&quot;&quot;</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cwd</span>

</div>
<span class="n">unixpath</span> <span class="o">=</span> <span class="n">meta_util_path</span><span class="o">.</span><span class="n">unixpath</span>
<span class="n">truepath</span> <span class="o">=</span> <span class="n">meta_util_path</span><span class="o">.</span><span class="n">truepath</span>
<span class="n">unixjoin</span> <span class="o">=</span> <span class="n">meta_util_path</span><span class="o">.</span><span class="n">unixjoin</span>


<div class="viewcode-block" id="relpath_unix"><a class="viewcode-back" href="../../utool.html#utool.util_path.relpath_unix">[docs]</a><span class="k">def</span> <span class="nf">relpath_unix</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">otherpath</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">otherpath</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="truepath_relative"><a class="viewcode-back" href="../../utool.html#utool.util_path.truepath_relative">[docs]</a><span class="k">def</span> <span class="nf">truepath_relative</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">otherpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Normalizes and returns absolute path with so specs  &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">otherpath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">otherpath</span> <span class="o">=</span> <span class="n">truepath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">normpath</span><span class="p">(</span><span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">otherpath</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="path_ndir_split"><a class="viewcode-back" href="../../utool.html#utool.util_path.path_ndir_split">[docs]</a><span class="k">def</span> <span class="nf">path_ndir_split</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">force_unix</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">winroot</span><span class="o">=</span><span class="s">&#39;C:&#39;</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Shows only a little bit of the path. Up to the n bottom-level directories</span>

<span class="sd">    TODO: rename to path_tail? ndir_split?</span>

<span class="sd">    Returns:</span>
<span class="sd">        (str) the trailing n paths of path.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; paths = [r&#39;/usr/bin/local/foo/bar&#39;,</span>
<span class="sd">        ...          r&#39;C:/&#39;,</span>
<span class="sd">        ...          #r&#39;lonerel&#39;,</span>
<span class="sd">        ...          #r&#39;reldir/other&#39;,</span>
<span class="sd">        ...          #r&#39;/ham&#39;,</span>
<span class="sd">        ...          #r&#39;/spam/eggs&#39;,</span>
<span class="sd">        ...          r&#39;C:\Program Files (x86)/foobar/bin&#39;,]</span>
<span class="sd">        &gt;&gt;&gt; N = 2</span>
<span class="sd">        &gt;&gt;&gt; iter_ = ut.iprod(paths, range(1, N + 1))</span>
<span class="sd">        &gt;&gt;&gt; force_unix = True</span>
<span class="sd">        &gt;&gt;&gt; tuplist = [(n, ut.path_ndir_split(path_, n)) for path_, n in iter_]</span>
<span class="sd">        &gt;&gt;&gt; chunklist = list(ut.ichunks(tuplist, N))</span>
<span class="sd">        &gt;&gt;&gt; list_ = [[&#39;n=%r: %r&#39; % tup for tup in chunk] for chunk in chunklist]</span>
<span class="sd">        &gt;&gt;&gt; line_list = [&#39;, &#39;.join(strs) for strs in list_]</span>
<span class="sd">        &gt;&gt;&gt; result = &#39;\n&#39;.join(line_list)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        n=1: &#39;bar&#39;, n=2: &#39;foo/bar&#39;</span>
<span class="sd">        n=1: &#39;C:/&#39;, n=2: &#39;C:/&#39;</span>
<span class="sd">        n=1: &#39;bin&#39;, n=2: &#39;foobar/bin&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ensure_crossplat_path</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span> <span class="k">if</span> <span class="n">force_unix</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
    <span class="n">ndirs_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">path_</span>
    <span class="k">for</span> <span class="n">nx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tail</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">head</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">head</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ndirs_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">head</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">/&#39;</span><span class="p">)</span>
                <span class="n">ndirs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ndirs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
    <span class="n">ndirs</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ndirs_list</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cplat_path</span> <span class="o">=</span> <span class="n">ensure_crossplat_path</span><span class="p">(</span><span class="n">ndirs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cplat_path</span>

</div>
<div class="viewcode-block" id="remove_file"><a class="viewcode-back" href="../../utool.html#utool.util_path.remove_file">[docs]</a><span class="k">def</span> <span class="nf">remove_file</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Removes a file &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dryrun</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Dryrem </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Removed </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path.remove_file] Misrem </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
            <span class="c">#warnings.warn(&#39;OSError: %s,\n Could not delete %s&#39; % (str(e), fpath))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_errors</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="remove_dirs"><a class="viewcode-back" href="../../utool.html#utool.util_path.remove_dirs">[docs]</a><span class="k">def</span> <span class="nf">remove_dirs</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Removes a directory &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Removing directory: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dpath</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dpath</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;OSError: </span><span class="si">%s</span><span class="s">,</span><span class="se">\n</span><span class="s"> Could not delete </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">dpath</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_errors</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="c">#import os</span>

</div>
<div class="viewcode-block" id="augpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.augpath">[docs]</a><span class="k">def</span> <span class="nf">augpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">augsuf</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">augext</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">augdir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">newext</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    augments end of path before the extension.</span>

<span class="sd">    augpath</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str):</span>
<span class="sd">        augsuf (str): augment filename before extension</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: newpath</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; path = &#39;somefile.txt&#39;</span>
<span class="sd">        &gt;&gt;&gt; augsuf = &#39;_aug&#39;</span>
<span class="sd">        &gt;&gt;&gt; newpath = augpath(path, augsuf)</span>
<span class="sd">        &gt;&gt;&gt; result = str(newpath)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        somefile_aug.txt</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; path = &#39;somefile.txt&#39;</span>
<span class="sd">        &gt;&gt;&gt; augsuf = &#39;_aug2&#39;</span>
<span class="sd">        &gt;&gt;&gt; newext = &#39;.bak&#39;</span>
<span class="sd">        &gt;&gt;&gt; augdir = &#39;backup&#39;</span>
<span class="sd">        &gt;&gt;&gt; newpath = augpath(path, augsuf, newext=newext, augdir=augdir)</span>
<span class="sd">        &gt;&gt;&gt; result = str(newpath)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        backup/somefile_aug2.bak</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Breakup path</span>
    <span class="n">dpath</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">fname_noext</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="c"># Augment ext</span>
    <span class="k">if</span> <span class="n">newext</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">newext</span> <span class="o">=</span> <span class="n">ext</span>
    <span class="c"># Augment fname</span>
    <span class="n">new_fname</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">fname_noext</span><span class="p">,</span> <span class="n">augsuf</span><span class="p">,</span> <span class="n">newext</span><span class="p">,</span> <span class="n">augext</span><span class="p">))</span>
    <span class="c"># Augment dpath</span>
    <span class="k">if</span> <span class="n">augdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">new_dpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">augdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="c"># create new dir if needebe</span>
            <span class="n">ensuredir</span><span class="p">(</span><span class="n">new_dpath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_dpath</span> <span class="o">=</span> <span class="n">dpath</span>
    <span class="c"># Recombine into new path</span>
    <span class="n">newpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">new_dpath</span><span class="p">,</span> <span class="n">new_fname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newpath</span>

</div>
<div class="viewcode-block" id="touch"><a class="viewcode-back" href="../../utool.html#utool.util_path.touch">[docs]</a><span class="k">def</span> <span class="nf">touch</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        fname (str)</span>
<span class="sd">        times (None):</span>
<span class="sd">        verbose (bool):</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; fname = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; times = None</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; result = touch(fname, times, verbose)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>

<span class="sd">    References:</span>
<span class="sd">        &#39;http://stackoverflow.com/questions/1158076/implement-touch-using-python&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] touching </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;touch </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
        <span class="k">raise</span>

</div>
<div class="viewcode-block" id="remove_files_in_dir"><a class="viewcode-back" href="../../utool.html#utool.util_path.remove_files_in_dir">[docs]</a><span class="k">def</span> <span class="nf">remove_files_in_dir</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">fname_pattern_list</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span>
                        <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Removes files matching a pattern from a directory &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname_pattern_list</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">fname_pattern_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">fname_pattern_list</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Removing files:&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;  * from dpath = </span><span class="si">%r</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">dpath</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;  * with patterns = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fname_pattern_list</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;  * recursive = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">recursive</span><span class="p">)</span>
    <span class="n">num_removed</span><span class="p">,</span> <span class="n">num_matched</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s">&#39;dryrun&#39;</span><span class="p">:</span> <span class="n">dryrun</span><span class="p">,</span>
        <span class="s">&#39;verbose&#39;</span><span class="p">:</span> <span class="n">verbose</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">dpath</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;!!! dir = </span><span class="si">%r</span><span class="s"> does not exist!&#39;</span> <span class="o">%</span> <span class="n">dpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dname_list</span><span class="p">,</span> <span class="n">fname_list</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dpath</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fname_pattern</span> <span class="ow">in</span> <span class="n">fname_pattern_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">fname_list</span><span class="p">,</span> <span class="n">fname_pattern</span><span class="p">):</span>
                <span class="n">num_matched</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">num_removed</span> <span class="o">+=</span> <span class="n">remove_file</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span>
                                           <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] ... Removed </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> files&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_removed</span><span class="p">,</span> <span class="n">num_matched</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="delete"><a class="viewcode-back" href="../../utool.html#utool.util_path.delete">[docs]</a><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">print_exists</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Removes a file or directory &quot;&quot;&quot;</span>
    <span class="c">#if verbose:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Deleting path=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">print_exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;..does not exist!&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">rmargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dryrun</span><span class="o">=</span><span class="n">dryrun</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                  <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">remove_files_in_dir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">rmargs</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="ow">and</span> <span class="n">remove_dirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">rmargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">remove_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">rmargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flag</span>

</div>
<div class="viewcode-block" id="remove_existing_fpaths"><a class="viewcode-back" href="../../utool.html#utool.util_path.remove_existing_fpaths">[docs]</a><span class="k">def</span> <span class="nf">remove_existing_fpaths</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">QUIET</span><span class="p">,</span>
                           <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">print_caller</span><span class="o">=</span><span class="n">PRINT_CALLER</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;files&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; checks existance before removing. then tries to remove exisint paths &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">print_caller</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">util_dbg</span><span class="o">.</span><span class="n">get_caller_name</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39; called remove_existing_fpaths&#39;</span><span class="p">)</span>
    <span class="n">fpath_list_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filter_Nones</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span>
    <span class="n">exists_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">exists</span><span class="p">,</span> <span class="n">fpath_list_</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">nTotal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span>
        <span class="n">nValid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list_</span><span class="p">)</span>
        <span class="n">nExist</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">exists_list</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path.remove_existing_fpaths] requesting delete of </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nTotal</span><span class="p">,</span> <span class="n">lbl</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nValid</span> <span class="o">!=</span> <span class="n">nTotal</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path.remove_existing_fpaths] trying to delete </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> non None </span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nValid</span><span class="p">,</span> <span class="n">nTotal</span><span class="p">,</span> <span class="n">lbl</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path.remove_existing_fpaths] </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> exist and need to be deleted&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nExist</span><span class="p">,</span> <span class="n">nValid</span><span class="p">))</span>
    <span class="n">existing_fpath_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filter_items</span><span class="p">(</span><span class="n">fpath_list_</span><span class="p">,</span> <span class="n">exists_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">remove_fpaths</span><span class="p">(</span><span class="n">existing_fpath_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span>
                            <span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">,</span> <span class="n">print_caller</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="remove_fpaths"><a class="viewcode-back" href="../../utool.html#utool.util_path.remove_fpaths">[docs]</a><span class="k">def</span> <span class="nf">remove_fpaths</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">QUIET</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">print_caller</span><span class="o">=</span><span class="n">PRINT_CALLER</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;files&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">print_caller</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">util_dbg</span><span class="o">.</span><span class="n">get_caller_name</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39; called remove_fpaths&#39;</span><span class="p">)</span>
    <span class="n">nTotal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span>
    <span class="n">_verbose</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">quiet</span> <span class="ow">and</span> <span class="n">nTotal</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">VERYVERBOSE</span>
    <span class="k">if</span> <span class="n">_verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path.remove_fpaths] try removing </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nTotal</span><span class="p">,</span> <span class="n">lbl</span><span class="p">))</span>
    <span class="n">nRemoved</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_list</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>  <span class="c"># Force refresh</span>
            <span class="n">nRemoved</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">VERYVERBOSE</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: Could not remove fpath = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fpath</span><span class="p">,))</span>
            <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
                <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;Could not remove fpath = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fpath</span><span class="p">,),</span> <span class="n">iswarning</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">raise</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">_verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path.remove_fpaths] ... removed </span><span class="si">%d</span><span class="s"> / </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nRemoved</span><span class="p">,</span> <span class="n">nTotal</span><span class="p">,</span> <span class="n">lbl</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">nRemoved</span>

</div>
<span class="n">remove_file_list</span> <span class="o">=</span> <span class="n">remove_fpaths</span>  <span class="c"># backwards compatible</span>


<div class="viewcode-block" id="longest_existing_path"><a class="viewcode-back" href="../../utool.html#utool.util_path.longest_existing_path">[docs]</a><span class="k">def</span> <span class="nf">longest_existing_path</span><span class="p">(</span><span class="n">_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  Returns the longest root of _path that exists &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">_path_new</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">_path_new</span><span class="p">):</span>
            <span class="n">_path</span> <span class="o">=</span> <span class="n">_path_new</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">_path_new</span> <span class="o">==</span> <span class="n">_path</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;!!! This is a very illformated path indeed.&#39;</span><span class="p">)</span>
            <span class="n">_path</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">break</span>
        <span class="n">_path</span> <span class="o">=</span> <span class="n">_path_new</span>
    <span class="k">return</span> <span class="n">_path</span>

</div>
<div class="viewcode-block" id="get_path_type"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_path_type">[docs]</a><span class="k">def</span> <span class="nf">get_path_type</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
    <span class="n">path_type</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
        <span class="n">path_type</span> <span class="o">+=</span> <span class="s">&#39;file&#39;</span>
    <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
        <span class="n">path_type</span> <span class="o">+=</span> <span class="s">&#39;directory&#39;</span>
    <span class="k">if</span> <span class="n">islink</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
        <span class="n">path_type</span> <span class="o">+=</span> <span class="s">&#39;link&#39;</span>
    <span class="k">if</span> <span class="n">ismount</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
        <span class="n">path_type</span> <span class="o">+=</span> <span class="s">&#39;mount&#39;</span>
    <span class="k">return</span> <span class="n">path_type</span>

</div>
<div class="viewcode-block" id="checkpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.checkpath">[docs]</a><span class="k">def</span> <span class="nf">checkpath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERYVERBOSE</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">VERYVERBOSE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; verbose wrapper around ``os.path.exists``</span>

<span class="sd">    Returns:</span>
<span class="sd">        true if ``path_`` exists on the filesystem show only the top n directories</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="c">#print_(&#39;[utool] checkpath(%r)&#39; % (path_))</span>
        <span class="n">pretty_path</span> <span class="o">=</span> <span class="n">path_ndir_split</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">caller_name</span> <span class="o">=</span> <span class="n">util_dbg</span><span class="o">.</span><span class="n">get_caller_name</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] checkpath(</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">caller_name</span><span class="p">,</span> <span class="n">pretty_path</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
            <span class="n">path_type</span> <span class="o">=</span> <span class="n">get_path_type</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span>
            <span class="c">#path_type = &#39;file&#39; if isfile(path_) else &#39;directory&#39;</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] ...(</span><span class="si">%s</span><span class="s">) exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">caller_name</span><span class="p">,</span> <span class="n">path_type</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] ... does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">caller_name</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
                <span class="c">#print(&#39;[util_path]  ! Does not exist&#39;)</span>
                <span class="n">_longest_path</span> <span class="o">=</span> <span class="n">longest_existing_path</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span>
                <span class="n">_longest_path_type</span> <span class="o">=</span> <span class="n">get_path_type</span><span class="p">(</span><span class="n">_longest_path</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] ... The longest existing path is: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">_longest_path</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] ... and has type </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_longest_path_type</span><span class="p">,))</span>

            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">exists</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ensurepath"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensurepath">[docs]</a><span class="k">def</span> <span class="nf">ensurepath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERYVERBOSE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; DEPRICATE - alias - use ensuredir instead &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ensuredir</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ensuredir"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensuredir">[docs]</a><span class="k">def</span> <span class="nf">ensuredir</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERYVERBOSE</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ensures that directory will exist &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">checkpath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] mkdir(</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">path_</span><span class="p">)</span>
        <span class="c">#os.makedirs(path_)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">normpath</span><span class="p">(</span><span class="n">path_</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;check that the longest existing path is not a bad windows symlink.&#39;</span><span class="p">)</span>
            <span class="k">raise</span>
    <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="assertpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.assertpath">[docs]</a><span class="k">def</span> <span class="nf">assertpath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Asserts that a patha exists &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">NO_ASSERTS</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">path_</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;Asserted path is None&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path_</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;Asserted path is the empty string&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">checkpath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;Asserted path does not exist: &#39;</span> <span class="o">+</span> <span class="n">path_</span><span class="p">)</span>


<span class="c"># ---File Copy---</span></div>
<div class="viewcode-block" id="copy_task"><a class="viewcode-back" href="../../utool.html#utool.util_path.copy_task">[docs]</a><span class="k">def</span> <span class="nf">copy_task</span><span class="p">(</span><span class="n">cp_list</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nooverwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">print_tasks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Copies all files src_i to dst_i</span>

<span class="sd">    Args:</span>
<span class="sd">        cp_list (list of tuples): [(src_1, dst_1), ..., (src_N, dst_N)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_overwrite</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_cp_tasks</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># Build this list with the actual tasks</span>
    <span class="k">if</span> <span class="n">nooverwrite</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Removed: copy task &#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Begining copy + overwrite task.&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">cp_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
            <span class="n">num_overwrite</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">print_tasks</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] !!! Overwriting &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nooverwrite</span><span class="p">:</span>
                <span class="n">_cp_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">print_tasks</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] ... Copying &#39;</span><span class="p">)</span>
                <span class="n">_cp_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">print_tasks</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path]    &#39;</span> <span class="o">+</span> <span class="n">src</span> <span class="o">+</span> <span class="s">&#39; -&gt; </span><span class="se">\n</span><span class="s">    &#39;</span> <span class="o">+</span> <span class="n">dst</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] About to copy </span><span class="si">%d</span><span class="s"> files&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">cp_list</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">nooverwrite</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Skipping </span><span class="si">%d</span><span class="s"> tasks which would have overwriten files&#39;</span> <span class="o">%</span> <span class="n">num_overwrite</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] There will be </span><span class="si">%d</span><span class="s"> overwrites&#39;</span> <span class="o">%</span> <span class="n">num_overwrite</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">test</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path]... Copying&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">_cp_tasks</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path]... Finished copying&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path]... In test mode. Nothing was copied.&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="copy"><a class="viewcode-back" href="../../utool.html#utool.util_path.copy">[docs]</a><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        src (str): file or directory to copy</span>
<span class="sd">        dst (str): directory or new file to copy to</span>

<span class="sd">    Copies src file or folder to dst.</span>

<span class="sd">    If src is a folder this copy is recursive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isdir</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isdir</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
            <span class="c"># copying file to directory</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">basename</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;C+O&#39;</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] [Copying + Overwrite]:&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;Skip&#39;</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] -&gt;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;C&#39;</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] [Copying]: &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] | </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">src</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] -&gt;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;Miss&#39;</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] [Cannot Copy]: &#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] src=</span><span class="si">%s</span><span class="s"> does not exist!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">src</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] dst=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="copy_all"><a class="viewcode-back" href="../../utool.html#utool.util_path.copy_all">[docs]</a><span class="k">def</span> <span class="nf">copy_all</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">,</span> <span class="n">glob_str_list</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">ensuredir</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glob_str_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">glob_str_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">glob_str_list</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">src_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dname_</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">glob_str</span> <span class="ow">in</span> <span class="n">glob_str_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">dname_</span><span class="p">,</span> <span class="n">glob_str</span><span class="p">):</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">dname_</span><span class="p">))</span>
                    <span class="n">dst</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="n">dname_</span><span class="p">))</span>
                    <span class="n">ensuredir</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fname_</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">glob_str</span> <span class="ow">in</span> <span class="n">glob_str_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">fname_</span><span class="p">,</span> <span class="n">glob_str</span><span class="p">):</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">fname_</span><span class="p">))</span>
                    <span class="n">dst</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="n">fname_</span><span class="p">))</span>
                    <span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">break</span>

</div>
<div class="viewcode-block" id="copy_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.copy_list">[docs]</a><span class="k">def</span> <span class="nf">copy_list</span><span class="p">(</span><span class="n">src_list</span><span class="p">,</span> <span class="n">dst_list</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;Copying: &#39;</span><span class="p">,</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Copies all data and stat info &quot;&quot;&quot;</span>
    <span class="c"># Feb - 6 - 2014 Copy function</span>
    <span class="n">num_tasks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_list</span><span class="p">)</span>
    <span class="n">task_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_list</span><span class="p">,</span> <span class="n">dst_list</span><span class="p">)</span>
    <span class="n">mark_progress</span><span class="p">,</span> <span class="n">end_progress</span> <span class="o">=</span> <span class="n">progress_func</span><span class="p">(</span><span class="n">num_tasks</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">docopy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span> <span class="n">shutil</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">mark_progress</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="n">success_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">docopy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">task_iter</span><span class="p">)]</span>
    <span class="n">end_progress</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">success_list</span>

</div>
<div class="viewcode-block" id="move"><a class="viewcode-back" href="../../utool.html#utool.util_path.move">[docs]</a><span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;Moving&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">move_list</span><span class="p">([</span><span class="n">src</span><span class="p">],</span> <span class="p">[</span><span class="n">dst</span><span class="p">],</span> <span class="n">lbl</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="move_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.move_list">[docs]</a><span class="k">def</span> <span class="nf">move_list</span><span class="p">(</span><span class="n">src_list</span><span class="p">,</span> <span class="n">dst_list</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;Moving&#39;</span><span class="p">):</span>
    <span class="c"># Feb - 6 - 2014 Move function</span>
    <span class="k">def</span> <span class="nf">domove</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">mark_progress</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="n">task_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_list</span><span class="p">,</span> <span class="n">dst_list</span><span class="p">)</span>
    <span class="n">mark_progress</span><span class="p">,</span> <span class="n">end_progress</span> <span class="o">=</span> <span class="n">progress_func</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">src_list</span><span class="p">),</span> <span class="n">lbl</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
    <span class="n">success_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">domove</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">task_iter</span><span class="p">)]</span>
    <span class="n">end_progress</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">success_list</span>

</div>
<div class="viewcode-block" id="win_shortcut"><a class="viewcode-back" href="../../utool.html#utool.util_path.win_shortcut">[docs]</a><span class="k">def</span> <span class="nf">win_shortcut</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">link_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempt to create windows shortcut</span>
<span class="sd">    TODO: TEST / FIXME</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">ctypes</span>
    <span class="n">csl</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="o">.</span><span class="n">CreateSymbolicLinkW</span>
    <span class="n">csl</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint32</span><span class="p">)</span>
    <span class="n">csl</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="n">csl</span><span class="p">(</span><span class="n">link_name</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c">#warn_msg = &#39;[util_path] Unable to create symbolic link on windows.&#39;</span>
        <span class="c">#print(warn_msg)</span>
        <span class="c">#warnings.warn(warn_msg, category=UserWarning)</span>
        <span class="k">if</span> <span class="n">checkpath</span><span class="p">(</span><span class="n">link_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">raise</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WinError</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="symlink"><a class="viewcode-back" href="../../utool.html#utool.util_path.symlink">[docs]</a><span class="k">def</span> <span class="nf">symlink</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">link_name</span><span class="p">,</span> <span class="n">noraise</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempt to create unix or windows symlink</span>
<span class="sd">    TODO: TEST / FIXME</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">link_name</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] symlink </span><span class="si">%r</span><span class="s"> exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">link_name</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Creating symlink: source=</span><span class="si">%r</span><span class="s"> link_name=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">link_name</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os_symlink</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;symlink&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">os_symlink</span><span class="p">):</span>
            <span class="n">os_symlink</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">link_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">win_shortcut</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">link_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">checkpath</span><span class="p">(</span><span class="n">link_name</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">checkpath</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">noraise</span><span class="p">:</span>
            <span class="k">raise</span>

</div>
<div class="viewcode-block" id="file_bytes"><a class="viewcode-back" href="../../utool.html#utool.util_path.file_bytes">[docs]</a><span class="k">def</span> <span class="nf">file_bytes</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns size of file in bytes (int)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>

</div>
<div class="viewcode-block" id="file_megabytes"><a class="viewcode-back" href="../../utool.html#utool.util_path.file_megabytes">[docs]</a><span class="k">def</span> <span class="nf">file_megabytes</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns size of file in megabytes (float)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mi">20</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="glob_python_modules"><a class="viewcode-back" href="../../utool.html#utool.util_path.glob_python_modules">[docs]</a><span class="k">def</span> <span class="nf">glob_python_modules</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">glob</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="s">&#39;*.py&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_dirs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="glob"><a class="viewcode-back" href="../../utool.html#utool.util_path.glob">[docs]</a><span class="k">def</span> <span class="nf">glob</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_files</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_dirs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="n">maxdepth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
         <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Globs directory for pattern</span>

<span class="sd">    Args:</span>
<span class="sd">        dirname    (str):</span>
<span class="sd">        pattern    (str):</span>
<span class="sd">        recursive  (bool):</span>
<span class="sd">        with_files (bool):</span>
<span class="sd">        with_dirs  (bool):</span>
<span class="sd">        maxdepth   (None):</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: path_list</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        iglob</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dirname</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;warning: star in dirname&#39;</span><span class="p">)</span>
    <span class="n">gen</span> <span class="o">=</span> <span class="n">iglob</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span>
                <span class="n">with_files</span><span class="o">=</span><span class="n">with_files</span><span class="p">,</span> <span class="n">with_dirs</span><span class="o">=</span><span class="n">with_dirs</span><span class="p">,</span> <span class="n">maxdepth</span><span class="o">=</span><span class="n">maxdepth</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">path_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_list</span>

</div>
<div class="viewcode-block" id="iglob"><a class="viewcode-back" href="../../utool.html#utool.util_path.iglob">[docs]</a><span class="k">def</span> <span class="nf">iglob</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_files</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_dirs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
          <span class="n">maxdepth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iteratively globs directory for pattern</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>  <span class="c"># log what i&#39;m going to do</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] glob(dirname=</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">truepath</span><span class="p">(</span><span class="n">dirname</span><span class="p">,))</span>
    <span class="n">nFiles</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nDirs</span>  <span class="o">=</span> <span class="mi">0</span>
    <span class="n">current_depth</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dirname_</span> <span class="o">=</span> <span class="n">truepath</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="n">posx1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirname_</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
    <span class="c">#print(&#39;\n\n\n&#39;)</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dirname_</span><span class="p">):</span>
        <span class="c"># yeild data</span>
        <span class="c"># print it only if you want</span>
        <span class="k">if</span> <span class="n">maxdepth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">current_depth</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="n">posx1</span><span class="p">:]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">maxdepth</span> <span class="o">&lt;=</span> <span class="n">current_depth</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="c">#print(&#39;-----------&#39;)</span>
        <span class="c">#print(current_depth)</span>
        <span class="c">#print(root)</span>
        <span class="c">#print(&#39;==&#39;)</span>
        <span class="c">#print(dirs)</span>
        <span class="c">#print(&#39;-----------&#39;)</span>
        <span class="k">if</span> <span class="n">with_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
                <span class="n">nFiles</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="n">fpath</span>
        <span class="k">if</span> <span class="n">with_dirs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">dirs</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
                <span class="n">dpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dname</span><span class="p">)</span>
                <span class="n">nDirs</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="n">dpath</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>  <span class="c"># log what i&#39;ve done</span>
        <span class="n">nTotal</span> <span class="o">=</span> <span class="n">nDirs</span> <span class="o">+</span> <span class="n">nFiles</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Found: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nTotal</span><span class="p">))</span>


<span class="c"># --- Images ----</span>
</div>
<div class="viewcode-block" id="num_images_in_dir"><a class="viewcode-back" href="../../utool.html#utool.util_path.num_images_in_dir">[docs]</a><span class="k">def</span> <span class="nf">num_images_in_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns the number of images in a directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_imgs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">matches_image</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
                <span class="n">num_imgs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">num_imgs</span>

</div>
<div class="viewcode-block" id="matches_image"><a class="viewcode-back" href="../../utool.html#utool.util_path.matches_image">[docs]</a><span class="k">def</span> <span class="nf">matches_image</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns true if a filename matches an image pattern &quot;&quot;&quot;</span>
    <span class="n">fname_</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">img_pats</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*&#39;</span> <span class="o">+</span> <span class="n">ext</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">IMG_EXTENSIONS</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">([</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">fname_</span><span class="p">,</span> <span class="n">pat</span><span class="p">)</span> <span class="k">for</span> <span class="n">pat</span> <span class="ow">in</span> <span class="n">img_pats</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="dirsplit"><a class="viewcode-back" href="../../utool.html#utool.util_path.dirsplit">[docs]</a><span class="k">def</span> <span class="nf">dirsplit</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="fpaths_to_fnames"><a class="viewcode-back" href="../../utool.html#utool.util_path.fpaths_to_fnames">[docs]</a><span class="k">def</span> <span class="nf">fpaths_to_fnames</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        fpath_list (list of strs): list of file-paths</span>
<span class="sd">    Returns:</span>
<span class="sd">        fname_list (list of strs): list of file-names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">split</span><span class="p">(</span><span class="n">fpath</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_list</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">fname_list</span>

</div>
<div class="viewcode-block" id="fnames_to_fpaths"><a class="viewcode-back" href="../../utool.html#utool.util_path.fnames_to_fpaths">[docs]</a><span class="k">def</span> <span class="nf">fnames_to_fpaths</span><span class="p">(</span><span class="n">fname_list</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fname_list</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">fpath_list</span>

</div>
<div class="viewcode-block" id="get_modpath_from_modname"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_modpath_from_modname">[docs]</a><span class="k">def</span> <span class="nf">get_modpath_from_modname</span><span class="p">(</span><span class="n">modname</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        modname (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: module_dir</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-get_modpath_from_modname</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; modname = &#39;utool.util_path&#39;</span>
<span class="sd">        &gt;&gt;&gt; module_dir = get_modpath_from_modname(modname)</span>
<span class="sd">        &gt;&gt;&gt; result = str(module_dir)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">importlib</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
    <span class="n">modpath</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.pyc&#39;</span><span class="p">,</span> <span class="s">&#39;.py&#39;</span><span class="p">)</span>
    <span class="c">#modname = modname.replace(&#39;.__init__&#39;, &#39;&#39;).strip()</span>
    <span class="c">#module_dir = get_module_dir(module)</span>
    <span class="k">return</span> <span class="n">modpath</span>

</div>
<div class="viewcode-block" id="get_module_dir"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_module_dir">[docs]</a><span class="k">def</span> <span class="nf">get_module_dir</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">module_dir</span> <span class="o">=</span> <span class="n">truepath</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__file__</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">module_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">module_dir</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module_dir</span>

</div>
<div class="viewcode-block" id="ensure_unixslash"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensure_unixslash">[docs]</a><span class="k">def</span> <span class="nf">ensure_unixslash</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ensure_crossplat_path"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensure_crossplat_path">[docs]</a><span class="k">def</span> <span class="nf">ensure_crossplat_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">winroot</span><span class="o">=</span><span class="s">&#39;C:&#39;</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    ensure_crossplat_path</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: crossplat_path</span>

<span class="sd">    Example(DOCTEST):</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; path = r&#39;C:\somedir&#39;</span>
<span class="sd">        &gt;&gt;&gt; cplat_path = ensure_crossplat_path(path)</span>
<span class="sd">        &gt;&gt;&gt; result = cplat_path</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        C:/somedir</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cplat_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cplat_path</span> <span class="o">==</span> <span class="n">winroot</span><span class="p">:</span>
        <span class="n">cplat_path</span> <span class="o">+=</span> <span class="s">&#39;/&#39;</span>
    <span class="k">return</span> <span class="n">cplat_path</span>

</div>
<div class="viewcode-block" id="ensure_native_path"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensure_native_path">[docs]</a><span class="k">def</span> <span class="nf">ensure_native_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">winroot</span><span class="o">=</span><span class="s">&#39;C:&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">WIN32</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="ow">or</span>  <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">winroot</span> <span class="o">+</span> <span class="n">path</span>

</div>
<div class="viewcode-block" id="get_relative_modpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_relative_modpath">[docs]</a><span class="k">def</span> <span class="nf">get_relative_modpath</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns path to module relative to the package root</span>

<span class="sd">    Args:</span>
<span class="sd">        module_fpath (str): module filepath</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: modname</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; module_fpath = ut.util_path.__file__</span>
<span class="sd">        &gt;&gt;&gt; rel_modpath = ut.get_relative_modpath(module_fpath)</span>
<span class="sd">        &gt;&gt;&gt; rel_modpath = rel_modpath.replace(&#39;.pyc&#39;, &#39;.py&#39;)  # allow pyc or py</span>
<span class="sd">        &gt;&gt;&gt; result = ensure_crossplat_path(rel_modpath)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        utool/util_path.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modsubdir_list</span> <span class="o">=</span> <span class="n">get_module_subdir_list</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">)</span>
    <span class="n">rel_modpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">modsubdir_list</span><span class="p">)</span> <span class="o">+</span> <span class="n">ext</span>
    <span class="n">rel_modpath</span> <span class="o">=</span> <span class="n">ensure_crossplat_path</span><span class="p">(</span><span class="n">rel_modpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rel_modpath</span>

</div>
<div class="viewcode-block" id="get_modname_from_modpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_modname_from_modpath">[docs]</a><span class="k">def</span> <span class="nf">get_modname_from_modpath</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns importable name from file path</span>

<span class="sd">    get_modname_from_modpath</span>

<span class="sd">    Args:</span>
<span class="sd">        module_fpath (str): module filepath</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: modname</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; module_fpath = ut.util_path.__file__</span>
<span class="sd">        &gt;&gt;&gt; modname = ut.get_modname_from_modpath(module_fpath)</span>
<span class="sd">        &gt;&gt;&gt; result = modname</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        utool.util_path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modsubdir_list</span> <span class="o">=</span> <span class="n">get_module_subdir_list</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">)</span>
    <span class="n">modname</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">modsubdir_list</span><span class="p">)</span>
    <span class="n">modname</span> <span class="o">=</span> <span class="n">modname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.__init__&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">modname</span>

</div>
<div class="viewcode-block" id="get_module_subdir_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_module_subdir_list">[docs]</a><span class="k">def</span> <span class="nf">get_module_subdir_list</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get_module_subdir_list</span>

<span class="sd">    Args:</span>
<span class="sd">        module_fpath (str):</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; module_fpath = ut.util_path.__file__</span>
<span class="sd">        &gt;&gt;&gt; modsubdir_list = get_module_subdir_list(module_fpath)</span>
<span class="sd">        &gt;&gt;&gt; result = modsubdir_list</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [&#39;utool&#39;, &#39;util_path&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">module_fpath</span> <span class="o">=</span> <span class="n">truepath</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">)</span>
    <span class="n">dpath</span><span class="p">,</span> <span class="n">fname_ext</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">)</span>
    <span class="n">fname</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">fname_ext</span><span class="p">)</span>
    <span class="n">full_dpath</span> <span class="o">=</span> <span class="n">dpath</span>
    <span class="n">dpath</span> <span class="o">=</span> <span class="n">full_dpath</span>
    <span class="n">_modsubdir_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">fname</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">is_module_dir</span><span class="p">(</span><span class="n">dpath</span><span class="p">):</span>
        <span class="n">dpath</span><span class="p">,</span> <span class="n">dname</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">dpath</span><span class="p">)</span>
        <span class="n">_modsubdir_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dname</span><span class="p">)</span>
    <span class="n">modsubdir_list</span> <span class="o">=</span> <span class="n">_modsubdir_list</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">modsubdir_list</span>

</div>
<div class="viewcode-block" id="tail"><a class="viewcode-back" href="../../utool.html#utool.util_path.tail">[docs]</a><span class="k">def</span> <span class="nf">tail</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Alias for path_ndir_split &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">path_ndir_split</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ls"><a class="viewcode-back" href="../../utool.html#utool.util_path.ls">[docs]</a><span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; like unix ls - lists all files and dirs in path&quot;&quot;&quot;</span>
    <span class="n">path_iter</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">path_iter</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="ls_dirs"><a class="viewcode-back" href="../../utool.html#utool.util_path.ls_dirs">[docs]</a><span class="k">def</span> <span class="nf">ls_dirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">):</span>
    <span class="n">dir_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_files</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dir_iter</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="ls_modulefiles"><a class="viewcode-back" href="../../utool.html#utool.util_path.ls_modulefiles">[docs]</a><span class="k">def</span> <span class="nf">ls_modulefiles</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">noext</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">module_file_list</span> <span class="o">=</span> <span class="n">ls</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;*.py&#39;</span><span class="p">)</span>
    <span class="n">module_file_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">module_file_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">private</span><span class="p">:</span>
        <span class="n">module_file_iter</span> <span class="o">=</span> <span class="n">filterfalse</span><span class="p">(</span><span class="n">is_private_module</span><span class="p">,</span> <span class="n">module_file_iter</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span>
        <span class="n">module_file_iter</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">module_file_iter</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">noext</span><span class="p">:</span>
        <span class="n">module_file_iter</span> <span class="o">=</span> <span class="p">(</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">module_file_iter</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">module_file_iter</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ls_moduledirs"><a class="viewcode-back" href="../../utool.html#utool.util_path.ls_moduledirs">[docs]</a><span class="k">def</span> <span class="nf">ls_moduledirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; lists all dirs which are python modules in path &quot;&quot;&quot;</span>
    <span class="n">dir_list</span> <span class="o">=</span> <span class="n">ls_dirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">module_dir_iter</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">is_module_dir</span><span class="p">,</span> <span class="n">dir_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">private</span><span class="p">:</span>
        <span class="n">module_dir_iter</span> <span class="o">=</span> <span class="n">filterfalse</span><span class="p">(</span><span class="n">is_private_module</span><span class="p">,</span> <span class="n">module_dir_iter</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span>
        <span class="n">module_dir_iter</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">module_dir_iter</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">module_dir_iter</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_basename_noext_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_basename_noext_list">[docs]</a><span class="k">def</span> <span class="nf">get_basename_noext_list</span><span class="p">(</span><span class="n">path_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">basename_noext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="get_ext_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_ext_list">[docs]</a><span class="k">def</span> <span class="nf">get_ext_list</span><span class="p">(</span><span class="n">path_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="get_basepath_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_basepath_list">[docs]</a><span class="k">def</span> <span class="nf">get_basepath_list</span><span class="p">(</span><span class="n">path_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="basename_noext"><a class="viewcode-back" href="../../utool.html#utool.util_path.basename_noext">[docs]</a><span class="k">def</span> <span class="nf">basename_noext</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="append_suffixlist_to_namelist"><a class="viewcode-back" href="../../utool.html#utool.util_path.append_suffixlist_to_namelist">[docs]</a><span class="k">def</span> <span class="nf">append_suffixlist_to_namelist</span><span class="p">(</span><span class="n">name_list</span><span class="p">,</span> <span class="n">suffix_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; adds a suffix to the path before the extension</span>
<span class="sd">    if name_list is a path_list the basepath is stripped away &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix_list</span><span class="p">)</span>
    <span class="c">#basepath_list  = utool.get_basepath_list(name_list)</span>
    <span class="n">gnamenoext_list</span> <span class="o">=</span> <span class="n">get_basename_noext_list</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
    <span class="n">ext_list</span>        <span class="o">=</span> <span class="n">get_ext_list</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
    <span class="n">new_name_list</span>   <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="n">ext</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">ext</span> <span class="ow">in</span>
                        <span class="nb">zip</span><span class="p">(</span><span class="n">gnamenoext_list</span><span class="p">,</span> <span class="n">suffix_list</span><span class="p">,</span> <span class="n">ext_list</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">new_name_list</span>

</div>
<div class="viewcode-block" id="is_private_module"><a class="viewcode-back" href="../../utool.html#utool.util_path.is_private_module">[docs]</a><span class="k">def</span> <span class="nf">is_private_module</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;__&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="is_module_dir"><a class="viewcode-back" href="../../utool.html#utool.util_path.is_module_dir">[docs]</a><span class="k">def</span> <span class="nf">is_module_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        path (str)</span>

<span class="sd">    Returns:</span>
<span class="sd">        flag: True if path contains an __init__ file</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; path = truepath(&#39;~/code/utool/utool&#39;)</span>
<span class="sd">        &gt;&gt;&gt; flag = is_module_dir(path)</span>
<span class="sd">        &gt;&gt;&gt; result = (flag)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="list_images"><a class="viewcode-back" href="../../utool.html#utool.util_path.list_images">[docs]</a><span class="k">def</span> <span class="nf">list_images</span><span class="p">(</span><span class="n">img_dpath_</span><span class="p">,</span> <span class="n">ignore_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fullpath</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">full</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; TODO: rename to ls_images</span>
<span class="sd">        TODO: Change all instances of fullpath to full</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#if not QUIET:</span>
    <span class="c">#    print(ignore_list)</span>
    <span class="k">if</span> <span class="n">full</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">fullpath</span> <span class="ow">or</span> <span class="n">full</span>
    <span class="n">img_dpath</span> <span class="o">=</span> <span class="n">realpath</span><span class="p">(</span><span class="n">img_dpath_</span><span class="p">)</span>
    <span class="n">ignore_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ignore_list</span><span class="p">)</span>
    <span class="n">gname_list_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">assertpath</span><span class="p">(</span><span class="n">img_dpath</span><span class="p">)</span>
    <span class="c"># Get all the files in a directory recursively</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dlist</span><span class="p">,</span> <span class="n">flist</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">truepath</span><span class="p">(</span><span class="n">img_dpath</span><span class="p">)):</span>
        <span class="n">rel_dpath</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">img_dpath</span><span class="p">)</span>
        <span class="c"># Ignore directories</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">dname</span> <span class="ow">in</span> <span class="n">ignore_set</span> <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="n">dirsplit</span><span class="p">(</span><span class="n">rel_dpath</span><span class="p">)]):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">flist</span><span class="p">):</span>
            <span class="n">gname</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">rel_dpath</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">matches_image</span><span class="p">(</span><span class="n">gname</span><span class="p">):</span>
                <span class="c"># Ignore Files</span>
                <span class="k">if</span> <span class="n">gname</span> <span class="ow">in</span> <span class="n">ignore_set</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">fullpath</span><span class="p">:</span>
                    <span class="n">gpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">img_dpath</span><span class="p">,</span> <span class="n">gname</span><span class="p">)</span>
                    <span class="n">gname_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gpath</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gname_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="c"># Filter out non images or ignorables</span>
    <span class="c">#gname_list = [gname_ for gname_ in iter(gname_list_)</span>
    <span class="c">#              if gname_ not in ignore_set and matches_image(gname_)]</span>
    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="n">gname_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">gname_list_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gname_list</span>

</div>
<div class="viewcode-block" id="assert_exists"><a class="viewcode-back" href="../../utool.html#utool.util_path.assert_exists">[docs]</a><span class="k">def</span> <span class="nf">assert_exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">NO_ASSERTS</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">assert</span> <span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="s">&#39;path=</span><span class="si">%r</span><span class="s"> does not exist!&#39;</span> <span class="o">%</span> <span class="n">path</span>

</div>
<div class="viewcode-block" id="grepfile"><a class="viewcode-back" href="../../utool.html#utool.util_path.grepfile">[docs]</a><span class="k">def</span> <span class="nf">grepfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">regexpr_list</span><span class="p">,</span> <span class="n">reflags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    grepfile - greps a specific file</span>

<span class="sd">    Args:</span>
<span class="sd">        fpath (str):</span>
<span class="sd">        regexpr_list (list or str): pattern or list of patterns</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple (list, list): list of lines and list of line numbers</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; fpath = ut.truepath(&#39;~/code/ibeis/ibeis/model/hots/smk/smk_match.py&#39;)</span>
<span class="sd">        &gt;&gt;&gt; regexpr_list = [&#39;get_argflag&#39;, &#39;get_argval&#39;]</span>
<span class="sd">        &gt;&gt;&gt; result = ut.grepfile(fpath, regexpr_list)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">found_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">found_lxs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># Ensure a list</span>
    <span class="n">islist</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regexpr_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
    <span class="n">regexpr_list_</span> <span class="o">=</span> <span class="n">regexpr_list</span> <span class="k">if</span> <span class="n">islist</span> <span class="k">else</span> <span class="p">[</span><span class="n">regexpr_list</span><span class="p">]</span>
    <span class="c"># Open file and search lines</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">file_</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="c"># Search each line for each pattern</span>
        <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">regexpr_</span> <span class="ow">in</span> <span class="n">regexpr_list_</span><span class="p">:</span>
                <span class="c"># FIXME: multiline mode doesnt work</span>
                <span class="n">match_object</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regexpr_</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">reflags</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match_object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">found_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">found_lxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">found_lines</span><span class="p">,</span> <span class="n">found_lxs</span>

</div>
<div class="viewcode-block" id="pathsplit_full"><a class="viewcode-back" href="../../utool.html#utool.util_path.pathsplit_full">[docs]</a><span class="k">def</span> <span class="nf">pathsplit_full</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; splits all directories in path into a list &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_standard_exclude_dnames"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_standard_exclude_dnames">[docs]</a><span class="k">def</span> <span class="nf">get_standard_exclude_dnames</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="s">&#39;lib.linux-x86_64-2.7&#39;</span><span class="p">,</span> <span class="s">&#39;dist&#39;</span><span class="p">,</span> <span class="s">&#39;build&#39;</span><span class="p">,</span> <span class="s">&#39;_page&#39;</span><span class="p">,</span> <span class="s">&#39;_doc&#39;</span><span class="p">,</span> <span class="s">&#39;utool.egg-info&#39;</span><span class="p">,</span> <span class="s">&#39;.git&#39;</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="get_standard_include_patterns"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_standard_include_patterns">[docs]</a><span class="k">def</span> <span class="nf">get_standard_include_patterns</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="s">&#39;*.py&#39;</span><span class="p">,</span> <span class="s">&#39;*.cxx&#39;</span><span class="p">,</span> <span class="s">&#39;*.cpp&#39;</span><span class="p">,</span> <span class="s">&#39;*.hxx&#39;</span><span class="p">,</span> <span class="s">&#39;*.hpp&#39;</span><span class="p">,</span> <span class="s">&#39;*.c&#39;</span><span class="p">,</span> <span class="s">&#39;*.h&#39;</span><span class="p">,</span> <span class="s">&#39;*.vim&#39;</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="matching_fnames"><a class="viewcode-back" href="../../utool.html#utool.util_path.matching_fnames">[docs]</a><span class="k">def</span> <span class="nf">matching_fnames</span><span class="p">(</span><span class="n">dpath_list</span><span class="p">,</span> <span class="n">include_patterns</span><span class="p">,</span> <span class="n">exclude_dirs</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">greater_exclude_dirs</span><span class="o">=</span><span class="p">[],</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    # TODO: fix names and behavior of exclude_dirs and greater_exclude_dirs</span>

<span class="sd">    matching_fnames. walks dpath lists returning all directories that match the</span>
<span class="sd">    requested pattern.</span>

<span class="sd">    Args:</span>
<span class="sd">        dpath_list       (list):</span>
<span class="sd">        include_patterns (?):</span>
<span class="sd">        exclude_dirs     (None):</span>
<span class="sd">        recursive        (bool):</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dpath_list = [dirname(dirname(ut.__file__))]</span>
<span class="sd">        &gt;&gt;&gt; include_patterns = get_standard_include_patterns()</span>
<span class="sd">        &gt;&gt;&gt; exclude_dirs = [&#39;_page&#39;]</span>
<span class="sd">        &gt;&gt;&gt; greater_exclude_dirs = get_standard_exclude_dnames()</span>
<span class="sd">        &gt;&gt;&gt; recursive = True</span>
<span class="sd">        &gt;&gt;&gt; fpath_gen = matching_fnames(dpath_list, include_patterns, exclude_dirs, greater_exclude_dirs, recursive)</span>
<span class="sd">        &gt;&gt;&gt; result = list(fpath_gen)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;\n&#39;.join(result))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dpath_list</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">dpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dpath_list</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">dpath</span> <span class="ow">in</span> <span class="n">dpath_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dname_list</span><span class="p">,</span> <span class="n">fname_list</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dpath</span><span class="p">):</span>
            <span class="c"># Look at all subdirs</span>
            <span class="n">subdirs</span> <span class="o">=</span> <span class="n">pathsplit_full</span><span class="p">(</span><span class="n">relpath</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dpath</span><span class="p">))</span>
            <span class="c"># HACK:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">dir_</span> <span class="ow">in</span> <span class="n">greater_exclude_dirs</span> <span class="k">for</span> <span class="n">dir_</span> <span class="ow">in</span> <span class="n">subdirs</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="c"># Look at one subdir</span>
            <span class="k">if</span> <span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="ow">in</span> <span class="n">exclude_dirs</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fname_list</span><span class="p">:</span>
                <span class="c"># For the filesnames which match the patterns</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pat</span><span class="p">)</span> <span class="k">for</span> <span class="n">pat</span> <span class="ow">in</span> <span class="n">include_patterns</span><span class="p">]):</span>
                    <span class="k">yield</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="c">#fname_list.append((root, name))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="c">#return fname_list</span>

</div>
<div class="viewcode-block" id="grep"><a class="viewcode-back" href="../../utool.html#utool.util_path.grep">[docs]</a><span class="k">def</span> <span class="nf">grep</span><span class="p">(</span><span class="n">regex_list</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dpath_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">include_patterns</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
         <span class="n">exclude_dirs</span><span class="o">=</span><span class="p">[],</span> <span class="n">greater_exclude_dirs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
         <span class="n">inverse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">reflags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Python implementation of grep. NOT FINISHED</span>

<span class="sd">    greps for patterns</span>

<span class="sd">    Args:</span>
<span class="sd">        regex_list (str or list): one or more patterns to find</span>
<span class="sd">        recursive (bool):</span>
<span class="sd">        dpath_list (list): directories to search (defaults to cwd)</span>
<span class="sd">        include_patterns (list) : defaults to standard file extensions</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple (list, list, list): (found_fpath_list, found_lines_list, found_lxs_list)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dpath_list = [ut.truepath(&#39;~/code/ibeis/ibeis&#39;)]</span>
<span class="sd">        &gt;&gt;&gt; include_patterns = [&#39;*.py&#39;]</span>
<span class="sd">        &gt;&gt;&gt; exclude_dirs = []</span>
<span class="sd">        &gt;&gt;&gt; regex_list = [&#39;get_argflag&#39;, &#39;get_argval&#39;]</span>
<span class="sd">        &gt;&gt;&gt; verbose = False</span>
<span class="sd">        &gt;&gt;&gt; recursive = True</span>
<span class="sd">        &gt;&gt;&gt; result = ut.grep(regex_list, recursive, dpath_list, include_patterns, exclude_dirs)</span>
<span class="sd">        &gt;&gt;&gt; (found_fpath_list, found_lines_list, found_lxs_list) = result</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">include_patterns</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">include_patterns</span> <span class="o">=</span>  <span class="n">get_standard_include_patterns</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">greater_exclude_dirs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">greater_exclude_dirs</span> <span class="o">=</span>  <span class="n">get_standard_exclude_dnames</span><span class="p">()</span>
    <span class="c"># ensure list input</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include_patterns</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">include_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">include_patterns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dpath_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">dpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">recursive_stat_str</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;flat&#39;</span><span class="p">,</span> <span class="s">&#39;recursive&#39;</span><span class="p">][</span><span class="n">recursive</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Greping (</span><span class="si">%s</span><span class="s">) </span><span class="si">%r</span><span class="s"> for </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">recursive_stat_str</span><span class="p">,</span> <span class="n">dpath_list</span><span class="p">,</span> <span class="n">regex_list</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regex_list</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">regex_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">regex_list</span><span class="p">]</span>
    <span class="n">found_fpath_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">found_lines_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">found_lxs_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># Walk through each directory recursively</span>
    <span class="n">fpath_generator</span> <span class="o">=</span> <span class="n">matching_fnames</span><span class="p">(</span><span class="n">dpath_list</span><span class="p">,</span> <span class="n">include_patterns</span><span class="p">,</span> <span class="n">exclude_dirs</span><span class="p">,</span> <span class="n">greater_exclude_dirs</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
    <span class="n">extended_regex_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">extend_regex</span><span class="p">,</span> <span class="n">regex_list</span><span class="p">))</span>
    <span class="c"># For each matching filepath</span>
    <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_generator</span><span class="p">:</span>
        <span class="c"># For each search pattern</span>
        <span class="n">found_lines</span><span class="p">,</span> <span class="n">found_lxs</span> <span class="o">=</span> <span class="n">grepfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">extended_regex_list</span><span class="p">,</span> <span class="n">reflags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inverse</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># Append files that the pattern was not found in</span>
                <span class="n">found_fpath_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
                <span class="n">found_lines_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="n">found_lxs_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">found_fpath_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>  <span class="c"># regular matching</span>
            <span class="n">found_lines_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">found_lines</span><span class="p">)</span>
            <span class="n">found_lxs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">found_lxs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] found matches in </span><span class="si">%d</span><span class="s"> files&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_fpath_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">found_fpath_list</span><span class="p">,</span> <span class="n">found_lines_list</span><span class="p">,</span> <span class="n">found_lxs_list</span>

</div>
<div class="viewcode-block" id="get_win32_short_path_name"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_win32_short_path_name">[docs]</a><span class="k">def</span> <span class="nf">get_win32_short_path_name</span><span class="p">(</span><span class="n">long_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the short path name of a given long path.</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/a/23598461/200291</span>
<span class="sd">        http://stackoverflow.com/questions/23598289/how-to-get-windows-short-file-name-in-python</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; #long_name = unicode(normpath(ut.get_resource_dir()))</span>
<span class="sd">        &gt;&gt;&gt; long_name = unicode(r&#39;C:/Program Files (x86)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #long_name = unicode(r&#39;C:/Python27&#39;)</span>
<span class="sd">        #unicode(normpath(ut.get_resource_dir()))</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; result = get_win32_short_path_name(long_name)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        C:/PROGRA~2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">ctypes</span>
    <span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="n">wintypes</span>
    <span class="n">_GetShortPathNameW</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="o">.</span><span class="n">GetShortPathNameW</span>
    <span class="n">_GetShortPathNameW</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">wintypes</span><span class="o">.</span><span class="n">LPCWSTR</span><span class="p">,</span> <span class="n">wintypes</span><span class="o">.</span><span class="n">LPWSTR</span><span class="p">,</span> <span class="n">wintypes</span><span class="o">.</span><span class="n">DWORD</span><span class="p">]</span>
    <span class="n">_GetShortPathNameW</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">wintypes</span><span class="o">.</span><span class="n">DWORD</span>
    <span class="n">output_buf_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">output_buf</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_unicode_buffer</span><span class="p">(</span><span class="n">output_buf_size</span><span class="p">)</span>
        <span class="n">needed</span> <span class="o">=</span> <span class="n">_GetShortPathNameW</span><span class="p">(</span><span class="n">long_name</span><span class="p">,</span> <span class="n">output_buf</span><span class="p">,</span> <span class="n">output_buf_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_buf_size</span> <span class="o">&gt;=</span> <span class="n">needed</span><span class="p">:</span>
            <span class="n">short_name</span> <span class="o">=</span> <span class="n">output_buf</span><span class="o">.</span><span class="n">value</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_buf_size</span> <span class="o">=</span> <span class="n">needed</span>
    <span class="k">return</span> <span class="n">short_name</span>

</div>
<div class="viewcode-block" id="fixwin32_shortname"><a class="viewcode-back" href="../../utool.html#utool.util_path.fixwin32_shortname">[docs]</a><span class="k">def</span> <span class="nf">fixwin32_shortname</span><span class="p">(</span><span class="n">path1</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c">#try:</span>
        <span class="c">#    import win32file</span>
        <span class="c">#    path2 = win32file.GetLongPathName(path1)</span>
        <span class="c">#except ImportError:</span>
            <span class="kn">import</span> <span class="nn">ctypes</span>
            <span class="c">#import win32file</span>
            <span class="n">path1</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span>
            <span class="n">buflen</span> <span class="o">=</span> <span class="mi">260</span>  <span class="c"># max size</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_unicode_buffer</span><span class="p">(</span><span class="n">buflen</span><span class="p">)</span>
            <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="o">.</span><span class="n">GetLongPathNameW</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">buflen</span><span class="p">)</span>
            <span class="c"># If the path doesnt exist windows doesnt return anything</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">path1</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;cannot fix win32 shortcut&#39;</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;path1&#39;</span><span class="p">,</span> <span class="s">&#39;path2&#39;</span><span class="p">])</span>
        <span class="n">path2</span> <span class="o">=</span> <span class="n">path1</span>
        <span class="c">#raise</span>
    <span class="k">return</span> <span class="n">path2</span>

</div>
<div class="viewcode-block" id="platform_path"><a class="viewcode-back" href="../../utool.html#utool.util_path.platform_path">[docs]</a><span class="k">def</span> <span class="nf">platform_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Returns platform specific path for pyinstaller usage</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: path2</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-platform_path</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # FIXME: find examples of the wird paths this fixes (mostly on win32 i think)</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; path = &#39;some/odd/../weird/path&#39;</span>
<span class="sd">        &gt;&gt;&gt; path2 = platform_path(path)</span>
<span class="sd">        &gt;&gt;&gt; result = str(path2)</span>
<span class="sd">        &gt;&gt;&gt; if ut.WIN32:</span>
<span class="sd">        ...     ut.assert_eq(path2, r&#39;some\weird\path&#39;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     ut.assert_eq(path2, r&#39;some/weird/path&#39;)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut    # NOQA</span>
<span class="sd">        &gt;&gt;&gt; if ut.WIN32:</span>
<span class="sd">        ...     path = &#39;C:/PROGRA~2&#39;</span>
<span class="sd">        ...     path2 = platform_path(path)</span>
<span class="sd">        ...     assert path2 == u&#39;..\\..\\..\\..\\Program Files (x86)&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;path cannot be the empty string&#39;</span><span class="p">)</span>
        <span class="c"># get path relative to cwd</span>
        <span class="n">path1</span> <span class="o">=</span> <span class="n">truepath_relative</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win32&#39;</span><span class="p">):</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">fixwin32_shortname</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">path1</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">,</span> <span class="s">&#39;path1&#39;</span><span class="p">,</span> <span class="s">&#39;path2&#39;</span><span class="p">])</span>
        <span class="k">raise</span>
    <span class="k">return</span> <span class="n">path2</span>

</div>
<div class="viewcode-block" id="existing_subpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.existing_subpath">[docs]</a><span class="k">def</span> <span class="nf">existing_subpath</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">valid_subpaths</span><span class="p">,</span> <span class="n">tiebreaker</span><span class="o">=</span><span class="s">&#39;first&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERYVERBOSE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns join(root_path, subpath) where subpath in valid_subpath ane</span>
<span class="sd">    exists(subpath)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Find the oxford_style groundtruth directory</span>
    <span class="k">for</span> <span class="n">subpath</span> <span class="ow">in</span> <span class="n">valid_subpaths</span><span class="p">:</span>
        <span class="n">path</span>  <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">checkpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tiebreaker</span> <span class="o">==</span> <span class="s">&#39;first&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">path</span>
    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;none of the following subpaths exist: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">valid_subpaths</span><span class="p">,))</span>


<span class="c">#def find_executable(exename):</span>
<span class="c">#    import utool as ut</span>
<span class="c">#    search_dpaths = ut.get_install_dirs()</span>
<span class="c">#    pass</span>

</div>
<div class="viewcode-block" id="search_in_dirs"><a class="viewcode-back" href="../../utool.html#utool.util_path.search_in_dirs">[docs]</a><span class="k">def</span> <span class="nf">search_in_dirs</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">search_dpaths</span><span class="o">=</span><span class="p">[],</span> <span class="n">shortcircuit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                   <span class="n">return_tried</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    search_in_dirs</span>

<span class="sd">    Args:</span>
<span class="sd">        fname (?):</span>
<span class="sd">        search_dpaths (list):</span>
<span class="sd">        shortcircuit (bool):</span>
<span class="sd">        return_tried(bool): return tried paths</span>

<span class="sd">    Returns:</span>
<span class="sd">        fpath: None</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; fname = &#39;Inno Setup 5\ISCC.exe&#39;</span>
<span class="sd">        &gt;&gt;&gt; search_dpaths = ut.get_install_dirs()</span>
<span class="sd">        &gt;&gt;&gt; shortcircuit = True</span>
<span class="sd">        &gt;&gt;&gt; fpath = ut.search_in_dirs(fname, search_dpaths, shortcircuit)</span>
<span class="sd">        &gt;&gt;&gt; print(fpath)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tried_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dpath</span> <span class="ow">in</span> <span class="n">search_dpaths</span><span class="p">:</span>
        <span class="n">fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_tried</span><span class="p">:</span>
            <span class="n">tried_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">shortcircuit</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">return_tried</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">tried_list</span>
                <span class="k">return</span> <span class="n">fpath</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fpath_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">strict</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Cannot find: fname=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">return_tried</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;Tried: </span><span class="se">\n</span><span class="s">    &#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tried_list</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">shortcircuit</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_tried</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="n">tried_list</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_tried</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fpath_list</span><span class="p">,</span> <span class="n">tried_list</span>
        <span class="k">return</span> <span class="n">fpath_list</span>

</div>
<div class="viewcode-block" id="find_lib_fpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.find_lib_fpath">[docs]</a><span class="k">def</span> <span class="nf">find_lib_fpath</span><span class="p">(</span><span class="n">libname</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">,</span> <span class="n">recurse_down</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Search for the library &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_lib_fname_list</span><span class="p">(</span><span class="n">libname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        input &lt;libname&gt;: library name (e.g. &#39;hesaff&#39;, not &#39;libhesaff&#39;)</span>
<span class="sd">        returns &lt;libnames&gt;: list of plausible library file names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win32&#39;</span><span class="p">):</span>
            <span class="n">libnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;lib&#39;</span> <span class="o">+</span> <span class="n">libname</span> <span class="o">+</span> <span class="s">&#39;.dll&#39;</span><span class="p">,</span> <span class="n">libname</span> <span class="o">+</span> <span class="s">&#39;.dll&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;darwin&#39;</span><span class="p">):</span>
            <span class="n">libnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;lib&#39;</span> <span class="o">+</span> <span class="n">libname</span> <span class="o">+</span> <span class="s">&#39;.dylib&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;linux&#39;</span><span class="p">):</span>
            <span class="n">libnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;lib&#39;</span> <span class="o">+</span> <span class="n">libname</span> <span class="o">+</span> <span class="s">&#39;.so&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unknown operating system: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">libnames</span>

    <span class="k">def</span> <span class="nf">get_lib_dpath_list</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        input &lt;root_dir&gt;: deepest directory to look for a library (dll, so, dylib)</span>
<span class="sd">        returns &lt;libnames&gt;: list of plausible directories to look.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="s">&#39;returns possible lib locations&#39;</span>
        <span class="n">get_lib_dpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">root_dir</span><span class="p">,</span>
                              <span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">),</span>
                              <span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="s">&#39;build&#39;</span><span class="p">),</span>
                              <span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="s">&#39;build&#39;</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">get_lib_dpath_list</span>

    <span class="n">lib_fname_list</span> <span class="o">=</span> <span class="n">get_lib_fname_list</span><span class="p">(</span><span class="n">libname</span><span class="p">)</span>
    <span class="n">tried_fpaths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">root_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lib_fname</span> <span class="ow">in</span> <span class="n">lib_fname_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lib_dpath</span> <span class="ow">in</span> <span class="n">get_lib_dpath_list</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>
                <span class="n">lib_fpath</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">lib_dpath</span><span class="p">,</span> <span class="n">lib_fname</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">lib_fpath</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">[c] Checked: &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tried_fpaths</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;using: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">lib_fpath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">lib_fpath</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Remember which candiate library fpaths did not exist</span>
                    <span class="n">tried_fpaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lib_fpath</span><span class="p">)</span>
            <span class="n">_new_root</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="n">root_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_new_root</span> <span class="o">==</span> <span class="n">root_dir</span><span class="p">:</span>
                <span class="n">root_dir</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">root_dir</span> <span class="o">=</span> <span class="n">_new_root</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recurse_down</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">[C!] load_clib(libname=</span><span class="si">%r</span><span class="s"> root_dir=</span><span class="si">%r</span><span class="s">, recurse_down=</span><span class="si">%r</span><span class="s">, verbose=</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span>
           <span class="p">(</span><span class="n">libname</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">,</span> <span class="n">recurse_down</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span> <span class="o">+</span>
           <span class="s">&#39;</span><span class="se">\n</span><span class="s">[c!] Cannot FIND dynamic library&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">[c!] Checked: &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tried_fpaths</span><span class="p">))</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ensure_mingw_drive"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensure_mingw_drive">[docs]</a><span class="k">def</span> <span class="nf">ensure_mingw_drive</span><span class="p">(</span><span class="n">win32_path</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot; replaces windows drives with mingw style drives</span>

<span class="sd">    Args:</span>
<span class="sd">        path (?):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-ensure_mingw_drive</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; win32_path = r&#39;C:/Program Files/Foobar&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = ensure_mingw_drive(win32_path)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        /c/Program Files/Foobar</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">win32_drive</span><span class="p">,</span> <span class="n">_path</span> <span class="o">=</span> <span class="n">splitdrive</span><span class="p">(</span><span class="n">win32_path</span><span class="p">)</span>
    <span class="n">mingw_drive</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">win32_drive</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">mingw_path</span> <span class="o">=</span> <span class="n">mingw_drive</span> <span class="o">+</span> <span class="n">_path</span>
    <span class="k">return</span> <span class="n">mingw_path</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -c &quot;import utool, utool.util_path; utool.doctest_funcs(utool.util_path, allexamples=True)&quot;</span>
<span class="sd">        python -m utool.util_path</span>
<span class="sd">        python -m utool.util_path --allexamples</span>
<span class="sd">        python -m utool.util_path --allexamples --noface --nosrc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>  <span class="c"># NOQA</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Jon Crall.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.dev1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>